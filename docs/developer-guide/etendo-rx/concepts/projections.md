---
tags:
    - Etendo RX
    - DAS service
    - Projections
    - Mappings
    - Connector
    - Search
    - API
---

# Projections and Mappings

## Overview

When using Spring Data JPA to implement the persistence layer, the repository typically returns one or more instances of the root class. However, more often than not, we do not need all the properties of the returned objects.

In such cases, we might want to retrieve data as objects of customized types. These types reflect partial views of the root class, containing only the necessary properties. This is where projections are useful.

To use this functionality, start by opening the *Projections and Mappings* window and creating a new projection with the following properties:

| Field       | Value                                 |
| ----------- | ------------------------------------- |
| Module      |`tutorial - 1.0.0 - English (USA)`     |
| Name        |`rxtutorial`                           |
| Description |`Projections needed for the tutorial`  |


  ![new-projection.png](../../../assets/developer-guide/etendo-rx/tutorial/new-projection.png)

## Projections and Mappings Window

:material-menu: `Application` > `Etendo RX` > `Projections and Mappings`

A **projection** is a set of specific fields from an entity or combined fields from multiple entities. Projections are useful when we need to retrieve only a subset of data, as it reduces the amount of data we need to retrieve from the database, leading to improved performance.

To create a new projection in Etendo, it is necessary to complete the fields in the header of the **Projections and Mappings** window.

![assign-projection.png](../../../assets/developer-guide/etendo-rx/tutorial/assign-projection.png) TO UPDATE
+ Description

- Organization: Organizational entity within client.
- Name: It describes the name of the projection
- Module: It indicates the module the element forms part of.
- Description: Description of the projection
- Active: A check to indicate whether this projection is available or disabled.

### Projected Entities Tab

In this tab, the entities to be projected can be defined. They can have two types of projections: Read and Write. This means that, when interacting with an external system, it is possible to read the information in the Etendo Classic database to expose it to the other system. The other option is to write information into the Etendo Classic database, that is, to extract external system information to use it in Etendo.

When referring to an entity to project, this entity is related to a specific table.

!!!Info
    It is necessary to create both records, a write type one and read type one. (?)

VA?

Fields to note:

- Organization: The corresponding organization of the entity
- Name: This field is autocompleted according to the options selected in the Table and Mapping Type fields, adding _Read_ or _Write_ accordingly.
- Table: It is the identifier that connects the Etendo entity to project with the database table, responsible to store the entity information.
- Mapping Type: In this case, there are two options: Etendo to external system and External system to Etendo. In the case of the Read type, the option to select is Etendo to external system. In the case of the Write type, the option to select is External system to Etendo.
- Is Rest Endpoint: Checkbox to allow the service to generate the endpoint or not.
    !!!info
        This box should not be checked, for example, when it is not necessary to expose a subentity endpoint.
- External_Name: parameter to call the API. It must be unique but it is possible to have more than one name for each entity. By default, it is autogenerated with the entity name, but in case of generating more than one, they should have different names.
- Active: A check to indicate whether this record is available or not.


#### Create Projection Fields Button

With this button, a pop up window is shown where you can find a list of all the fields to project and select the necessary ones.

!!!info
   The mandatory fields to project can be filtered with the _Is mandatory_ column.

#### Entity Field Subtab

In this subtab, each entity field to be included in the projection can be defined by the developer.

VA?

=== "Read Type"

    Fields to note:

    - Module: It indicates the module the element forms part of.
    - Organization: The corresponding organization of the entity
    - Property: Properties to be included. Standard field. Autogenerated from Link to parent column? "...List" records include a second table. the option "_identifier" is a string.
    - Name: Key del JSON de salida
    - Identifies Record Univocally: Checkbox to use this record as an identifier. If no field has this check selected, the database ID of the table will be used.

    Mapping Configuration

    - Field Mapping: 
      - Direct Mapping: each property is shown as it is.
      - Java Mapping: Connected to the Java Mapping window. If this option is chosen, it allows you to define other aspects of the mapping and the result of the mapping will be type Json.
      - Entity Mapping: this option applies the option selected in Related Projection entity to each element of the list.
      - Constant Mapping: If you choose this option, the same defined constant value is always shown. This means in this case is always necessary to define a constant value in the corresponding field to be used.
    - Related Projection Entity: Extra field shown when Entity Mapping option above is selected. Here, you can select the property to be projected for each entity in the mapping.
    - Constant Value: Only available when Constant Mapping is selected as the Mapping type. Here, you define the constant value to be used in the mapping.
    - Related Projection Identifiers: information field to revise the identifier of the mapped table.
    - Active: A check to indicate whether this record is available or disabled.

=== "Write Type"

    Fields to note:

    - Module: It indicates the module the element forms part of.
    - Organization: The corresponding organization of the entity
    - Property: Properties to be included. Standard field. Autogenerated from Link to parent column? "...List" records include a second table. The option "_identifier" is a string.
    - Name: Key del JSON de salida
    - Is Mandatory: Only available for "Write" projections
    - Identifies Record Univocally: Checkbox to use this record as an identifier. If no field has this check selected, the database ID will be used.

    Mapping Configuration

    - Field Mapping: 
      - Direct Mapping: each property is shown(written in the database?) as it is.
      - Java Mapping: Connected to the [Java Mappings](#java-mappings) window. If this option is chosen, it allows you to define other aspects of the mapping and the result of the mapping will be type Json
      - Entity Mapping: this option applies the option selected in Related Projection entity to each element of the list.
      - Constant Mapping: If you choose this option, the same defined constant value is always written. This can be used for a primitivo? field.
    - Create related: It enables the creation of related elements from.... Only available for Write type mappings.
    - Related Projection Entity: Extra field shown when Entity Mapping option above is selected.
    - Jsonpath: language to extract properties from Json objects. For more information, visit [Json](https://en.wikipedia.org/wiki/JSONPath){target="_blank"}.
    - Constant Value: Only available when Constant Mapping is selected as the Mapping type. Here, you define the constant value to be used in the mapping.
    - Related Projection Identifiers: information field to check the identifier of the mapped table.
    - Active: A check to indicate whether this record is available or disabled.

    Map Fields to Child

    This subtab allows the possibility to provide information from the parent fields to the child records.

    Fields to note:

    - Module:
    - Organization:
    - Related Field:
    - Property:
    - Active:

## Tables and Columns Window

:material-menu: `Application` > `Application Dictionary` > `Tables and Columns`

#### Search

### Adding Entity Fields

When a projection is created, we need to define which fields we want to retrieve.
In our case, we will need the record ID, Business Partner name, Document No, Document Type name, and the Grand total.
Under the Projection tab navigate to the *Entity Field* tab and add the following fields:

|  Field Name         |  Property             |
| ------------------- | --------------------- |
| id                  |`id`                   |
| businessPartnerName |`businessPartner.name` |
| documentNo          |`documentNo`           |
| documentTypeName    |`documentType.name`    |
| grandTotalAmount    |`grandTotalAmount`     |

!!!note
    The *Property* field of this tab is handled with an Entity Mapping, this is like a Hibernate property.
    So, you can navigate the entities related from here. E.g. To get the Business Partner name, you can have it by accessing the entity *businessPartner* and then, adding the field that you want to filter, *name* in this case.


  ![new-entity-fields.png](../../../assets/developer-guide/etendo-rx/tutorial/new-entity-fields.png)

------------------------------------------------------------------

### Repository Tab

In Spring Data, a repository is an abstraction that provides the operations relative to a domain class to interact with a data store.
To create the repository for our purpose, and the same as we did for projections, we need to go to Tables and Columns and look for `C_Order` table.

#### Creating a New Repository

After selecting a table, in this case `C_Order`, we need to go to *Repository* tab and create a new record with the following values:

| Field       | Value                                |
| ----------- | ------------------------------------ |
| Module      |`tutorial - 1.0.0 - English (USA)`    |


 ![new-repository.png](../../../assets/developer-guide/etendo-rx/tutorial/new-repository.png)

------------------------------------------------------------------

### Search

#### Creating a New Search

Next, we will define a search method to use later when we want to consume the orders. This query is taken as a filter for retrieving the orders.
To create this new filter/search method, under Repository tab of the `C_Order` table, create a new record with the following data:

| Field       | Value                                                                                  |
| ----------- | -------------------------------------------------------------------------------------- |
| Method Name |`findSalesOrder`                                                                        |
|  Query      |`select o from Order o where o.documentType.id = :documentType order by o.documentNo`   |


  ![new-search.png](../../../assets/developer-guide/etendo-rx/tutorial/new-search.png)

#### Creating a New Search Parameter

As you can see in the query above, we use a parameter called `:documentType`. 
We can add this type of parameter to use it later by adding a corresponding value to it and filtering depending on the current needs.
To define the parameter, we need to create a new row on the *Search Parameter* tab of the *Search* tab. Fill it with the following settings:

| Field | Value         |
| ----- | ------------- |
| Line  |`10`           |
| Name  |`documentType` |
| Type  |`String`       |

In our case, we will filter depending on the Document Type of the orders.

  ![new-search-parameter.png](../../../assets/developer-guide/etendo-rx/tutorial/new-search-parameter.png)

## Java Mappings Window

:material-menu: `Application` > `Etendo RX` > `Java Mappings`

In this window, you can define Java mappings to apply more specific options to mappings configurations. This option expands the possibilities beyond the possible configurations with the other types of mappings.......

VA

Fields to note:

- Module:
- Organization:
- Name:
- Description:
- Qualifier: Tag that identifies the record for correct RX identification. This must be unique.
- Mapping Type:
- Table:
- Active: Checkbox

MORE INFO about Java Mappings in a Confluence file? Ask Seba for more info about this.

## Constant Values Window

:material-menu: `Application` > `Etendo RX` > `Constant Values`

In this window, it is possible to define constant values to be used for mappings configured in the [Projections and Mappings](#projections-and-mappings) window.

VA

Fields to note:

- Module:
- Organization:
- Name:
- Constant Value: